---
title: "15 Insights from Utah School Enrollment Data"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{15 Insights from Utah School Enrollment Data}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  message = FALSE,
  warning = FALSE,
  fig.width = 8,
  fig.height = 5,
  cache = TRUE
)
```

```{r load-packages}
library(utschooldata)
library(dplyr)
library(tidyr)
library(ggplot2)

theme_set(theme_minimal(base_size = 14))

# Get available years dynamically
available_years <- get_available_years()
min_year <- min(available_years)
max_year <- max(available_years)
```

This vignette explores Utah's public school enrollment data, surfacing key trends and demographic patterns across available years of data.

---

## 1. Utah grew 7% since 2014 but is now declining

Utah added over 44,000 students from 2014 to its 2022 peak, but enrollment has fallen three of the last four years, dropping below 660,000 in 2026.

```{r statewide-trend}
enr <- fetch_enr_multi(available_years, use_cache = TRUE)

state_totals <- enr |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  select(end_year, n_students) |>
  mutate(change = n_students - lag(n_students),
         pct_change = round(change / lag(n_students) * 100, 2))

stopifnot(nrow(state_totals) > 0)
state_totals
```

```{r statewide-chart}
ggplot(state_totals, aes(x = end_year, y = n_students)) +
  geom_line(linewidth = 1.2, color = "#CC0000") +
  geom_point(size = 3, color = "#CC0000") +
  geom_vline(xintercept = 2020, linetype = "dashed", color = "gray50", alpha = 0.7) +
  annotate("text", x = 2020, y = Inf, label = "COVID", vjust = 2, hjust = 0.5, size = 3, color = "gray50") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = paste0("Utah Public School Enrollment (", min_year, "-", max_year, ")"),
    subtitle = "Growth peaked in 2022, now declining",
    x = "School Year (ending)",
    y = "Total Enrollment"
  )
```

---

## 2. Granite and Alpine are Utah's enrollment giants

Utah's two largest districts--Alpine and Granite--anchor the Wasatch Front, but their trajectories differ. Salt Lake District has seen steep declines while suburban districts hold steady.

```{r largest-districts}
large_districts <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         district_name %in% c("Granite District", "Alpine District", "Davis District",
                              "Jordan District", "Canyons District", "Salt Lake District")) |>
  select(end_year, district_name, n_students)

stopifnot(nrow(large_districts) > 0)

large_districts |>
  filter(end_year == max(end_year)) |>
  arrange(desc(n_students))
```

```{r top-districts-chart}
enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         district_name %in% c("Granite District", "Alpine District", "Davis District", "Jordan District")) |>
  ggplot(aes(x = end_year, y = n_students, color = district_name)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Utah's Largest Districts: Enrollment Trends",
    subtitle = "The Big Four along the Wasatch Front",
    x = "School Year",
    y = "Enrollment",
    color = "District"
  )
```

---

## 3. Utah's student body is diversifying

While Utah remains less diverse than national averages, Hispanic enrollment has grown substantially over the past decade, now representing nearly 22% of students.

```{r demographics}
enr_latest <- fetch_enr(max_year, use_cache = TRUE)

demographics <- enr_latest |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("hispanic", "white", "black", "asian", "native_american", "pacific_islander", "multiracial")) |>
  mutate(pct = round(pct * 100, 1)) |>
  select(subgroup, n_students, pct) |>
  arrange(desc(n_students))

stopifnot(nrow(demographics) > 0)
demographics
```

```{r demographics-chart}
demographics |>
  mutate(subgroup = forcats::fct_reorder(subgroup, n_students)) |>
  ggplot(aes(x = n_students, y = subgroup, fill = subgroup)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(pct, "%")), hjust = -0.1) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = paste0("Utah Student Demographics (", max_year, ")"),
    subtitle = "White students remain the majority, but diversity is increasing",
    x = "Number of Students",
    y = NULL
  )
```

---

## 4. Pacific Islander students are a unique Utah story

Utah has one of the highest concentrations of Pacific Islander students in the nation, reflecting the state's significant Polynesian community, particularly in Salt Lake County.

```{r pacific-islander}
pi_districts <- enr_latest |>
  filter(is_district, grade_level == "TOTAL", subgroup == "pacific_islander") |>
  filter(n_students > 100) |>
  mutate(pct = round(pct * 100, 2)) |>
  select(district_name, n_students, pct) |>
  arrange(desc(pct)) |>
  head(10)

stopifnot(nrow(pi_districts) > 0)
pi_districts
```

```{r pacific-islander-chart}
pi_districts |>
  mutate(district_name = forcats::fct_reorder(district_name, pct)) |>
  ggplot(aes(x = pct, y = district_name, fill = n_students)) +
  geom_col() +
  scale_fill_viridis_c(option = "plasma", labels = scales::comma) +
  labs(
    title = "Pacific Islander Students as % of District Enrollment",
    subtitle = "Utah has one of the highest PI student populations nationally",
    x = "Percent of District",
    y = NULL,
    fill = "Students"
  )
```

---

## 5. Nebo District is the Utah County growth leader

Provo, Alpine, and Nebo districts in Utah County show diverging paths since 2019. Nebo grew 26% while Provo lost nearly 20% of students as young families settle further south along the I-15 corridor.

```{r utah-county}
utah_county <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Alpine|Provo|Nebo", district_name, ignore.case = TRUE)) |>
  group_by(district_name) |>
  arrange(end_year) |>
  summarize(
    first_year = first(n_students),
    last_year = last(n_students),
    pct_change = round((last_year / first_year - 1) * 100, 1),
    .groups = "drop"
  ) |>
  arrange(desc(pct_change))

stopifnot(nrow(utah_county) > 0)
utah_county
```

```{r growth-chart}
enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         district_name %in% c("Alpine District", "Provo District", "Nebo District", "Washington District")) |>
  ggplot(aes(x = end_year, y = n_students, color = district_name)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Utah's Growing Districts",
    subtitle = "Utah County and St. George area lead growth",
    x = "School Year",
    y = "Enrollment",
    color = "District"
  )
```

---

## 6. Rural districts face decline

While the Wasatch Front booms, rural districts in southern and eastern Utah face enrollment pressure as families move to urban centers for jobs and services.

```{r rural-decline}
rural <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Carbon|Emery|Grand|San Juan|Millard", district_name, ignore.case = TRUE)) |>
  group_by(district_name) |>
  filter(n() >= 5) |>
  arrange(end_year) |>
  summarize(
    first_year = first(n_students),
    last_year = last(n_students),
    pct_change = round((last_year / first_year - 1) * 100, 1),
    .groups = "drop"
  ) |>
  arrange(pct_change)

stopifnot(nrow(rural) > 0)
rural
```

```{r regional-chart}
enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         grepl("Carbon|Emery|Grand|San Juan", district_name, ignore.case = TRUE)) |>
  ggplot(aes(x = end_year, y = n_students, color = district_name)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Rural Utah Districts: Enrollment Challenges",
    subtitle = "Eastern Utah districts losing students",
    x = "School Year",
    y = "Enrollment",
    color = "District"
  )
```

---

## 7. Washington County is Utah's fastest-growing region

The St. George area (Washington County School District) has exploded with growth as retirees and remote workers flock to southern Utah, though growth has slowed since 2023.

```{r washington-county}
washington <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         district_name == "Washington District") |>
  select(end_year, district_name, n_students) |>
  mutate(change = n_students - lag(n_students),
         pct_change = round(change / lag(n_students) * 100, 1))

stopifnot(nrow(washington) > 0)
washington
```

```{r washington-chart}
washington |>
  ggplot(aes(x = end_year, y = n_students)) +
  geom_area(fill = "#E65100", alpha = 0.3) +
  geom_line(color = "#E65100", linewidth = 1.2) +
  geom_point(color = "#E65100", size = 3) +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Washington County School District Enrollment",
    subtitle = "St. George area leads Utah in enrollment growth",
    x = "School Year",
    y = "Total Enrollment"
  )
```

---

## 8. Charter schools serve over a quarter of Utah students

Utah has a robust charter school sector, with over 26% of public school students attending charter schools--one of the highest rates in the nation.

```{r charters}
state_total <- enr_latest |>
  filter(is_state, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  pull(n_students)

charter_total <- enr_latest |>
  filter(is_charter, subgroup == "total_enrollment", grade_level == "TOTAL") |>
  summarize(charter_total = sum(n_students, na.rm = TRUE)) |>
  pull(charter_total)

charter_summary <- tibble(
  sector = c("All Public Schools", "Charter Schools"),
  enrollment = c(state_total, charter_total),
  pct = c(100, round(charter_total / state_total * 100, 1))
)

stopifnot(nrow(charter_summary) > 0)
charter_summary
```

```{r charters-chart}
tibble(
  sector = c("Traditional Districts", "Charter Schools"),
  enrollment = c(state_total - charter_total, charter_total)
) |>
  mutate(pct = enrollment / sum(enrollment) * 100,
         label = paste0(round(pct, 1), "%")) |>
  ggplot(aes(x = "", y = enrollment, fill = sector)) +
  geom_col(width = 1) +
  coord_polar(theta = "y") +
  geom_text(aes(label = label), position = position_stack(vjust = 0.5), color = "white", size = 5) +
  scale_fill_manual(values = c("Traditional Districts" = "#1976D2", "Charter Schools" = "#43A047")) +
  labs(
    title = paste0("Utah Public School Enrollment by Sector (", max_year, ")"),
    subtitle = "Charter schools serve over a quarter of students",
    fill = NULL
  ) +
  theme_void() +
  theme(legend.position = "bottom", plot.title = element_text(hjust = 0.5), plot.subtitle = element_text(hjust = 0.5))
```

---

## 9. Kindergarten enrollment dipped during COVID and keeps falling

Unlike many states that saw a COVID bounce-back, Utah kindergarten enrollment has continued to decline, dropping from 50,363 in 2014 to 43,519 in 2026.

```{r covid-k}
covid_grades <- enr |>
  filter(is_state, subgroup == "total_enrollment",
         grade_level %in% c("K", "01", "05", "09")) |>
  select(end_year, grade_level, n_students) |>
  pivot_wider(names_from = grade_level, values_from = n_students)

stopifnot(nrow(covid_grades) > 0)
covid_grades
```

```{r covid-chart}
enr |>
  filter(is_state, subgroup == "total_enrollment",
         grade_level %in% c("K", "01", "05", "09")) |>
  mutate(grade_level = factor(grade_level, levels = c("K", "01", "05", "09"),
                               labels = c("Kindergarten", "1st Grade", "5th Grade", "9th Grade"))) |>
  ggplot(aes(x = end_year, y = n_students, color = grade_level)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  geom_vline(xintercept = 2020, linetype = "dashed", color = "gray50", alpha = 0.7) +
  annotate("text", x = 2020, y = Inf, label = "COVID", vjust = 2, hjust = 0.5, size = 3, color = "gray50") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Utah Grade-Level Enrollment Over Time",
    subtitle = "Kindergarten keeps declining while 9th grade peaked in 2023",
    x = "School Year",
    y = "Enrollment",
    color = "Grade"
  )
```

---

## 10. High school enrollment surged 24% since 2014

As larger elementary cohorts from the 2010s moved through the system, Utah high schools saw significant enrollment growth--though 2026 marks the first decline.

```{r high-school}
hs_trend <- enr |>
  filter(is_state, subgroup == "total_enrollment",
         grade_level %in% c("09", "10", "11", "12")) |>
  group_by(end_year) |>
  summarize(hs_total = sum(n_students, na.rm = TRUE), .groups = "drop") |>
  mutate(change = hs_total - lag(hs_total),
         pct_change = round(change / lag(hs_total) * 100, 1))

stopifnot(nrow(hs_trend) > 0)
hs_trend
```

```{r high-school-chart}
hs_trend |>
  ggplot(aes(x = end_year, y = hs_total)) +
  geom_area(fill = "#7B1FA2", alpha = 0.3) +
  geom_line(color = "#7B1FA2", linewidth = 1.2) +
  geom_point(color = "#7B1FA2", size = 3) +
  geom_vline(xintercept = 2020, linetype = "dashed", color = "gray50", alpha = 0.7) +
  annotate("text", x = 2020, y = Inf, label = "COVID", vjust = 2, hjust = 0.5, size = 3, color = "gray50") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Utah High School Enrollment (Grades 9-12)",
    subtitle = "Growth peaked in 2025, first decline in 2026",
    x = "School Year",
    y = "Total HS Enrollment"
  )
```

---

## 11. Hispanic enrollment grew 46% since 2014

Utah's Hispanic student population has grown significantly faster than overall enrollment, adding nearly 45,000 students in just over a decade.

```{r hispanic-growth}
hispanic <- enr |>
  filter(is_state, grade_level == "TOTAL", subgroup == "hispanic") |>
  select(end_year, n_students) |>
  mutate(change = n_students - lag(n_students),
         pct_change = round(change / lag(n_students) * 100, 1))

stopifnot(nrow(hispanic) > 0)
hispanic
```

```{r hispanic-chart}
hispanic |>
  ggplot(aes(x = end_year, y = n_students)) +
  geom_area(fill = "#FF6F00", alpha = 0.3) +
  geom_line(color = "#FF6F00", linewidth = 1.2) +
  geom_point(color = "#FF6F00", size = 3) +
  geom_vline(xintercept = 2020, linetype = "dashed", color = "gray50", alpha = 0.7) +
  annotate("text", x = 2020, y = Inf, label = "COVID", vjust = 2, hjust = 0.5, size = 3, color = "gray50") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Hispanic Student Enrollment in Utah",
    subtitle = paste0("From ", format(min(hispanic$n_students), big.mark = ","), " to ",
                      format(max(hispanic$n_students), big.mark = ","), " students"),
    x = "School Year",
    y = "Hispanic Students"
  )
```

---

## 12. English learner population grew 70% since 2014

The number of English learners (ELL/LEP) in Utah schools has grown from 34,000 to over 58,000 since 2014--a 70% increase that outpaces overall enrollment growth by nearly 10x.

```{r ell-growth}
ell_trend <- enr |>
  filter(is_state, grade_level == "TOTAL", subgroup == "lep") |>
  select(end_year, n_students, pct) |>
  mutate(pct = round(pct * 100, 1),
         change = n_students - lag(n_students),
         pct_change = round(change / lag(n_students) * 100, 1))

stopifnot(nrow(ell_trend) > 0)
ell_trend
```

```{r ell-chart}
ell_trend |>
  ggplot(aes(x = end_year, y = n_students)) +
  geom_area(fill = "#00897B", alpha = 0.3) +
  geom_line(color = "#00897B", linewidth = 1.2) +
  geom_point(color = "#00897B", size = 3) +
  geom_vline(xintercept = 2020, linetype = "dashed", color = "gray50", alpha = 0.7) +
  annotate("text", x = 2020, y = Inf, label = "COVID", vjust = 2, hjust = 0.5, size = 3, color = "gray50") +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "English Learner Students in Utah",
    subtitle = "ELL population grew 70% since 2014",
    x = "School Year",
    y = "ELL Students"
  )
```

---

## 13. Nearly 1 in 3 students are economically disadvantaged

About 28% of Utah students qualify as economically disadvantaged--lower than the national average but still representing over 186,000 students.

```{r econ-disadv}
special_pops <- enr_latest |>
  filter(is_state, grade_level == "TOTAL",
         subgroup %in% c("econ_disadv", "lep", "special_ed")) |>
  mutate(pct = round(pct * 100, 1)) |>
  select(subgroup, n_students, pct) |>
  arrange(desc(n_students))

stopifnot(nrow(special_pops) > 0)
special_pops
```

```{r special-pops-chart}
special_pops |>
  mutate(subgroup = forcats::fct_recode(subgroup,
    "Economically Disadvantaged" = "econ_disadv",
    "Special Education" = "special_ed",
    "English Learners" = "lep")) |>
  mutate(subgroup = forcats::fct_reorder(subgroup, n_students)) |>
  ggplot(aes(x = n_students, y = subgroup, fill = subgroup)) +
  geom_col(show.legend = FALSE) +
  geom_text(aes(label = paste0(pct, "%")), hjust = -0.1) +
  scale_x_continuous(labels = scales::comma, expand = expansion(mult = c(0, 0.15))) +
  scale_fill_brewer(palette = "Set1") +
  labs(
    title = paste0("Utah Special Populations (", max_year, ")"),
    subtitle = "Economically disadvantaged, special education, and ELL students",
    x = "Number of Students",
    y = NULL
  )
```

---

## 14. Kindergarten enrollment dropped 14% since 2014

Utah kindergarten enrollment has fallen from 50,363 in 2014 to 43,519 in 2026--a 14% decline--even as high school grades hit record levels. This signals future total enrollment declines.

```{r grade-distribution}
grades <- enr_latest |>
  filter(is_state, subgroup == "total_enrollment") |>
  filter(!grade_level %in% c("TOTAL")) |>
  select(grade_level, n_students) |>
  arrange(desc(n_students))

stopifnot(nrow(grades) > 0)
grades
```

```{r grade-distribution-chart}
grades |>
  mutate(grade_level = factor(grade_level,
         levels = c("PK", "K", "01", "02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12"))) |>
  mutate(level = case_when(
    grade_level %in% c("PK", "K", "01", "02", "03", "04", "05") ~ "Elementary",
    grade_level %in% c("06", "07", "08") ~ "Middle",
    TRUE ~ "High School"
  )) |>
  ggplot(aes(x = grade_level, y = n_students, fill = level)) +
  geom_col() +
  scale_y_continuous(labels = scales::comma) +
  scale_fill_manual(values = c("Elementary" = "#1976D2", "Middle" = "#FFA000", "High School" = "#7B1FA2")) +
  labs(
    title = paste0("Utah Enrollment by Grade Level (", max_year, ")"),
    subtitle = "Elementary grades smaller than high school--unusual for a growing state",
    x = "Grade Level",
    y = "Enrollment",
    fill = "Level"
  )
```

---

## 15. Salt Lake City district lost 21% of students since 2019

While suburban districts hold steady, Salt Lake City School District has declined from over 22,000 to under 18,000 students--a loss driven by housing costs and demographic shifts in the urban core.

```{r salt-lake-decline}
salt_lake <- enr |>
  filter(is_district, subgroup == "total_enrollment", grade_level == "TOTAL",
         district_name == "Salt Lake District") |>
  select(end_year, district_name, n_students) |>
  mutate(change = n_students - lag(n_students),
         pct_change = round(change / lag(n_students) * 100, 1))

stopifnot(nrow(salt_lake) > 0)
salt_lake
```

```{r salt-lake-chart}
salt_lake |>
  ggplot(aes(x = end_year, y = n_students)) +
  geom_area(fill = "#D32F2F", alpha = 0.3) +
  geom_line(color = "#D32F2F", linewidth = 1.2) +
  geom_point(color = "#D32F2F", size = 3) +
  scale_y_continuous(labels = scales::comma) +
  labs(
    title = "Salt Lake City School District Enrollment",
    subtitle = "Urban core district losing students to suburbs",
    x = "School Year",
    y = "Total Enrollment"
  )
```

---

## Summary

Utah's school enrollment data reveals:

- **Recent decline**: After years of growth, Utah enrollment peaked in 2022 and has fallen since
- **Wasatch Front dominance**: The Salt Lake-Provo corridor holds most students
- **Southern boom**: Washington County (St. George) grew fastest but is now slowing
- **Rural challenges**: Eastern Utah districts losing students to urban areas
- **Diversifying demographics**: Hispanic and Pacific Islander populations growing
- **Charter expansion**: Charter schools serve over 26% of students
- **Grade-level shift**: Kindergarten declining 14% while high school grew 24%

These patterns reflect Utah's unique demographics--the youngest state in the nation--and rapid population growth along the Wasatch Front and in southwestern Utah.

---

*Data sourced from the Utah State Board of Education [Data and Statistics](https://schools.utah.gov/datastatistics/reports).*

---

## Session Info

```{r session-info}
sessionInfo()
```
